参考文章: <https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html> 

​		<https://juejin.im/post/6844903889678893063> 

##### 线程池是什么

```tex
	线程池（Thread Pool）是一种基于池化思想管理线程的工具，经常出现在多线程服务器中，如MySQL。而本文描述线程池是JDK中提供的ThreadPoolExecutor类。
	线程池中是以生产者消费者模式，通过一个阻塞队列来实现的.阻塞队列缓存任务，工作线程从阻塞队列中获取任务。 线程池的本质是对任务和线程的管理.
```

##### 使用线程池可以带来一系列好处

```tex
1: 降低资源消耗：通过池化技术重复利用已创建的线程，降低线程创建和销毁造成的损耗。
2: 提高响应速度：任务到达时，无需等待线程创建即可立即执行。
3: 提高线程的可管理性：线程是稀缺资源，如果无限制创建，不仅会消耗系统资源，还会因为线程的不合理分布导致资源调度失衡，降低系统的稳定性。使用线程池可以进行统一的分配、调优和监控。
4: 提供更多更强大的功能：线程池具备可拓展性，允许开发人员向其中增加更多的功能。比如延时定时线程池ScheduledThreadPoolExecutor，就允许任务延期执行或定期执行。
```

##### 线程池解决的问题是什么

```tex
	线程池解决的核心问题就是资源管理问题。在并发环境下，系统不能够确定在任意时刻中，有多少任务需要执行，有多少资源需要投入。这种不确定性将带来以下若干问题：
	1: 频繁申请/销毁资源和调度资源，将带来额外的消耗，可能会非常巨大。
	2: 对资源无限申请缺少抑制手段，易引发系统资源耗尽的风险。
	3: 系统无法合理管理内部的资源分布，会降低系统的稳定性。	
```

##### 线程池工作流程

![](../picture/31bad766983e212431077ca8da92762050214.png)

**任务缓冲** 

```tex
	任务缓冲模块是线程池能够管理任务的核心部分。线程池的本质是对任务和线程的管理，而做到这一点最关键的思想就是将任务和线程两者解耦，不让两者直接关联，才可以做后续的分配工作。线程池中是以生产者消费者模式，通过一个阻塞队列来实现的。阻塞队列缓存任务，工作线程从阻塞队列中获取任务。
```

![](../picture/725a3db5114d95675f2098c12dc331c3316963.png)

**任务拒绝** 

```tex
任务拒绝模块是线程池的保护部分，线程池有一个最大的容量，当线程池的任务缓存队列已满，并且线程池中的线程数目达到maximumPoolSize时，就需要拒绝掉该任务，采取任务拒绝策略，保护线程池。
public interface RejectedExecutionHandler {
    void rejectedExecution(Runnable r, ThreadPoolExecutor executor);
}
用户可以通过实现这个接口去定制拒绝策略，也可以选择JDK提供的四种已有拒绝策略，其特点如下：
```

![](../picture/9ffb64cc4c64c0cb8d38dac01c89c905178456.png)



